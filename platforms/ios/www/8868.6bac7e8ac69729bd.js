"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8868],{8868:(q,u,c)=>{c.r(u),c.d(u,{CheckoutPageModule:()=>P});var g=c(9808),h=c(3075),m=c(3697),i=c(3349),_=c(655),e=c(5e3),p=c(6419),Z=c(9937);function v(o,l){if(1&o&&(e.TgZ(0,"ion-buttons",4),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij("",e.lcZ(2,1,t.total_amount)," \xa0")}}function f(o,l){1&o&&(e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label"),e._uU(2,"Este comercio no tiene servicio a domicilio"),e.qZA(),e.qZA())}function y(o,l){1&o&&(e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label"),e._uU(2,"Entrega a domicilio"),e.qZA(),e._UZ(3,"ion-radio",13),e.qZA())}function C(o,l){1&o&&(e.TgZ(0,"ion-item"),e.TgZ(1,"ion-label"),e._uU(2,"Recoger en tienda (No se cobrar\xe1 env\xedo)"),e.qZA(),e._UZ(3,"ion-radio",14),e.qZA())}function T(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"ion-item",6),e.TgZ(1,"ion-label"),e._UZ(2,"img",15),e.TgZ(3,"span",16),e._uU(4,"Pay Via Stripe"),e.qZA(),e.qZA(),e.TgZ(5,"ion-radio",17),e.NdJ("ionSelect",function(){return e.CHM(t),e.oxw(2).setPayment(3)}),e.qZA(),e.qZA()}}function x(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"p"),e._uU(2,"Proporcione los siguientes detalles"),e.qZA(),e.TgZ(3,"ion-row"),e.TgZ(4,"ion-col",18),e.TgZ(5,"ion-item"),e.TgZ(6,"ion-label",19),e._uU(7,"Card Number"),e.qZA(),e.TgZ(8,"ion-input",20),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).card_no=n}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"ion-col",21),e.TgZ(10,"ion-item"),e.TgZ(11,"ion-label",19),e._uU(12,"Exp Month"),e.qZA(),e.TgZ(13,"ion-input",22),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).exp_month=n}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(14,"ion-col",21),e.TgZ(15,"ion-item"),e.TgZ(16,"ion-label",19),e._uU(17,"Exp Year"),e.qZA(),e.TgZ(18,"ion-input",23),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).exp_year=n}),e.qZA(),e.qZA(),e.qZA(),e.TgZ(19,"ion-col",18),e.TgZ(20,"ion-item"),e.TgZ(21,"ion-label",19),e._uU(22,"CVV"),e.qZA(),e.TgZ(23,"ion-input",24),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw(2).cvv=n}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.oxw(2);e.xp6(8),e.Q6J("ngModel",t.card_no),e.xp6(5),e.Q6J("ngModel",t.exp_month),e.xp6(5),e.Q6J("ngModel",t.exp_year),e.xp6(5),e.Q6J("ngModel",t.cvv)}}function A(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"ion-content"),e.TgZ(1,"ion-card"),e.TgZ(2,"ion-card-header"),e.TgZ(3,"ion-card-title"),e._uU(4,"Seleccionar tipo de orden"),e.qZA(),e.qZA(),e.TgZ(5,"ion-card-content"),e.TgZ(6,"ion-list"),e.TgZ(7,"ion-radio-group",5),e.NdJ("ionChange",function(n){return e.CHM(t),e.oxw().setType(n)}),e.YNc(8,f,3,0,"ion-item",3),e.YNc(9,y,4,0,"ion-item",3),e.YNc(10,C,4,0,"ion-item",3),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(11,"ion-card"),e.TgZ(12,"ion-card-header"),e.TgZ(13,"ion-card-title"),e._uU(14," Metodo de pago "),e.qZA(),e.qZA(),e.TgZ(15,"ion-card-content"),e.TgZ(16,"ion-radio-group",5),e.NdJ("ionChange",function(n){return e.CHM(t),e.oxw().setPayment(n)}),e.TgZ(17,"ion-item",6),e.TgZ(18,"ion-label"),e._UZ(19,"img",7),e._uU(20," Pagar en efectivo"),e.qZA(),e.TgZ(21,"ion-radio",8),e.NdJ("ionSelect",function(){return e.CHM(t),e.oxw().setPayment(1)}),e.qZA(),e.qZA(),e.YNc(22,T,6,0,"ion-item",9),e.qZA(),e.YNc(23,x,24,4,"div",3),e.qZA(),e.qZA(),e.TgZ(24,"div",10),e.TgZ(25,"ion-item"),e.TgZ(26,"ion-textarea",11),e.NdJ("ngModelChange",function(n){return e.CHM(t),e.oxw().notes=n}),e.qZA(),e.qZA(),e._UZ(27,"br"),e.TgZ(28,"ion-button",12),e.NdJ("click",function(){return e.CHM(t),e.oxw().makeOrder()}),e._uU(29,"Confirmar orden"),e.qZA(),e.qZA(),e._UZ(30,"br"),e.qZA()}if(2&o){const t=e.oxw();e.xp6(7),e.s9C("value",t.otype),e.xp6(1),e.Q6J("ngIf",0==t.delivery_type),e.xp6(1),e.Q6J("ngIf",1==t.delivery_type),e.xp6(1),e.Q6J("ngIf",1==t.pickup),e.xp6(6),e.s9C("value",t.payment),e.xp6(6),e.Q6J("ngIf",t.stripe_id),e.xp6(1),e.Q6J("ngIf",t.stripeView),e.xp6(3),e.Q6J("ngModel",t.notes),e.xp6(2),e.Q6J("disabled",!t.formVal())}}const S=[{path:"",component:(()=>{class o{constructor(t,a,n,r,d,s){this.server=t,this.toastController=a,this.loadingController=n,this.alertController=r,this.nav=d,this.stripe=s,this.stripeView=!1,this.otype=1,this.text=JSON.parse(localStorage.getItem("app_text")),this.address=localStorage.getItem("address_id"),this.admin=JSON.parse(localStorage.getItem("admin")),this.send_terminal=this.admin.send_terminal,this.comm_stripe=this.admin.comm_stripe}ngOnInit(){}ionViewWillEnter(){localStorage.getItem("user_id")&&"null"!=localStorage.getItem("user_id")?this.loadData():(this.nav.navigateRoot("/login"),this.presentToast("Please login for continue."))}setType(t){2==t.detail.value?(this.total_amount=Number(this.total_amount)-Number(this.delivery_charges),this.delivery_status=!1):0==this.delivery_status&&(this.total_amount=Number(this.total_amount)+Number(this.delivery_charges)),this.otype=t.detail.value,this.payment=!1,this.stripeView=!1}formVal(){return 1==this.otype?!(!this.address||!this.payment):!!this.payment}setPayment(t){this.payment=t.detail.value,3==t.detail.value?1==this.send_terminal?this.ConfirmPayStripe():this.stripeView=!0:1==this.stripeView&&(this.total_amount=Number(this.total_amount)-Number(this.iva_stripe),this.stripeView=!1)}ConfirmPayStripe(){return(0,_.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:"Advertencia!!",message:"El pago via tarjeta de Cr\xe9dito/D\xe9bito genera una comisi\xf3n de "+this.comm_stripe+" %",mode:"ios",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:a=>{this.stripeView=!1}},{text:"Aceptar",handler:()=>{this.total_amount=Number(this.total_amount)+Number(this.getComm(this.total_amount,this.comm_stripe)),this.stripeView=!0}}]})).present()})}getComm(t,a){return this.iva_stripe=Math.round(t*a/100),Math.round(this.iva_stripe)}loadData(){return(0,_.mG)(this,void 0,void 0,function*(){const t=yield this.loadingController.create({message:"Espere porfavor...",mode:"ios"});yield t.present();var a=localStorage.getItem("lid")?localStorage.getItem("lid"):0,n=localStorage.getItem("current_lat")?localStorage.getItem("current_lat"):0,r=localStorage.getItem("current_lng")?localStorage.getItem("current_lng"):0;this.server.getCart(localStorage.getItem("cart_no")+"?lid="+a+"&lat="+n+"&lng="+r).subscribe(d=>{console.log(d),this.store_id=d.data.data[0].store_id,this.server.getDeliveryType(this.store_id).subscribe(s=>{this.delivery_type=s[0][0].service_del,this.pickup=s[0][0].pickup,0==this.delivery_type&&(this.otype=2)}),this.server.getAddress(localStorage.getItem("user_id")+"?cart_no="+localStorage.getItem("cart_no")+"&store="+this.store_id+"&lid="+a+"&lat="+n+"&lng="+r).subscribe(s=>{this.data=s.data,console.log(this.data),s.data.address.length>0||this.nav.navigateRoot("/address"),this.total_amount=s.data.total,this.delivery_charges=s.data.Comercio.delivery_charges_value,s.data.Comercio.Cuenta_clave&&(this.Cuenta_clave=s.data.Comercio.Cuenta_clave,this.banco_name=s.data.Comercio.banco_name),this.admin.paypal_client_id&&(this.paypal_id=this.admin.paypal_client_id),this.admin.stripe_client_id&&(this.stripe_id=this.admin.stripe_client_id)}),t.dismiss()})})}makeOrder(){2==this.payment?this.payPaypal():3==this.payment?this.payWithStripe():this.order()}order(){return(0,_.mG)(this,void 0,void 0,function*(){const t=yield this.loadingController.create({message:"Porfavor espere...",mode:"ios"});yield t.present();var a=localStorage.getItem("current_lat")?localStorage.getItem("current_lat"):0,n=localStorage.getItem("current_lng")?localStorage.getItem("current_lng"):0,r={user_id:localStorage.getItem("user_id"),payment:this.payment,address:this.address,cart_no:localStorage.getItem("cart_no"),payment_id:this.payment_id,otype:this.otype,notes:this.notes,lat:a,lng:n};this.server.order(r).subscribe(d=>{if("Not_service"==d.data)t.dismiss(),this.presentToast("Sin servicio en la ubicaci\xf3n Seleccionada");else{let s=[];localStorage.getItem("LastStore")?(s=JSON.parse(localStorage.getItem("LastStore")),s.find(b=>this.store_id).store_id!=this.store_id&&s.push({store_id:this.store_id})):s.push({store_id:this.store_id}),localStorage.setItem("LastStore",JSON.stringify(s)),localStorage.setItem("order_data",JSON.stringify(d.data)),this.nav.navigateRoot("/done"),t.dismiss()}})})}payPaypal(){}payWithStripe(){return(0,_.mG)(this,void 0,void 0,function*(){const t=yield this.loadingController.create({});yield t.present(),this.card_no.length>10&&this.exp_month&&this.exp_year&&this.cvv?(t.dismiss(),this.stripe.setPublishableKey(this.stripe_id),this.stripe.createCardToken({number:this.card_no,expMonth:this.exp_month,expYear:this.exp_year,cvc:this.cvv}).then(n=>{this.makePayment(n.id)}).catch(n=>{this.presentToast("Por favor ingrese detalles de pago v\xe1lidos")})):(t.dismiss(),this.presentToast("Por favor ingrese detalles de pago v\xe1lidos"))})}payWithTransfer(){this.presentToast("Una vez realizada la transferencia no te olvides de enviarle el ticket al comercio."),this.payment_id=0,this.order()}makePayment(t){return(0,_.mG)(this,void 0,void 0,function*(){const a=yield this.loadingController.create({message:"Enviando Informacion...",mode:"ios"});yield a.present(),this.server.makeStripePayment("?token="+t+"&amount="+this.total_amount).subscribe(n=>{"done"==n.data?(this.payment_id=n.id,this.payment_id&&this.order()):this.presentToast("Algo sali\xf3 mal. Por favor, vuelva a intentarlo."),a.dismiss()})})}presentToast(t){return(0,_.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:t,duration:2e3,position:"bottom"})).present()})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(p.N),e.Y36(i.yF),e.Y36(i.HT),e.Y36(i.Br),e.Y36(i.SH),e.Y36(Z.h))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-checkout"]],decls:9,vars:2,consts:[["slot","start"],["slot","start","name","arrow-back","routerLink","/cart","routerDirection","back"],["slot","end",4,"ngIf"],[4,"ngIf"],["slot","end"],[3,"value","ionChange"],[2,"font-size","13px"],["src","assets/cash.png",2,"width","30px"],["slot","start","value","1",3,"ionSelect"],["style","font-size: 13px",4,"ngIf"],[1,"ion-padding"],["placeholder","Agrega Cualquier instrucci\xf3n para la comida ... por ejemplo, extra picante","name","notes",3,"ngModel","ngModelChange"],["expand","block","mode","ios","type","button",3,"disabled","click"],["slot","start","value","1"],["slot","start","value","2"],["src","assets/stripe.png",2,"width","150px"],[2,"margin-top","-40px"],["slot","start","value","2",3,"ionSelect"],["size","12"],["position","floating"],["type","tel","name","card_no",3,"ngModel","ngModelChange"],["size","6"],["type","tel","name","exp_month",3,"ngModel","ngModelChange"],["type","tel","name","exp_year",3,"ngModel","ngModelChange"],["type","tel","name","cvv",3,"ngModel","ngModelChange"]],template:function(t,a){1&t&&(e.TgZ(0,"ion-header"),e.TgZ(1,"ion-toolbar"),e.TgZ(2,"ion-buttons",0),e._uU(3," \xa0"),e._UZ(4,"ion-icon",1),e.qZA(),e.TgZ(5,"ion-title"),e._uU(6," Pagar "),e.qZA(),e.YNc(7,v,3,3,"ion-buttons",2),e.qZA(),e.qZA(),e.YNc(8,A,31,9,"ion-content",3)),2&t&&(e.xp6(7),e.Q6J("ngIf",a.data),e.xp6(1),e.Q6J("ngIf",a.data))},directives:[i.Gu,i.sr,i.Sm,i.gu,i.YI,m.rH,i.wd,g.O5,i.W2,i.PM,i.Zi,i.Dq,i.FN,i.q_,i.se,i.QI,i.Ie,i.Q$,i.B7,i.U5,i.j9,i.g2,h.JJ,h.On,i.YG,i.Nd,i.wI,i.pK],pipes:[g.H9],styles:[""]}),o})()}];let P=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[g.ez,h.u5,i.Pc,m.Bz.forChild(S)]]}),o})()}}]);